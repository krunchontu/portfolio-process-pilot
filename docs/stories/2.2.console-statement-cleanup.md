# <!-- Powered by BMAD™ Core -->

# Story 2.2: Console Statement Cleanup

## Status
Draft

## Story
**As a** production system,  
**I want** proper logging instead of console statements,  
**So that** logs are structured and manageable

## Acceptance Criteria
1. Replace remaining console statements with Winston logger
2. Remove development artifacts from production code
3. Ensure proper log levels for different message types
4. Maintain setup script console.log statements (acceptable for CLI tools)
5. Verify no console statements remain in core application logic

## Tasks / Subtasks
- [ ] Identify and replace remaining console statements (AC: 1, 2)
  - [ ] Fix `backend/src/middleware/auth.js:74` - Replace `console.error` with Winston logger
  - [ ] Audit codebase for any other console statements in core logic
  - [ ] Replace with appropriate Winston logger calls (`logger.error`, `logger.warn`, etc.)
  - [ ] Verify setup/migration scripts can keep console.log (acceptable)
- [ ] Implement proper log levels (AC: 3)
  - [ ] Use `logger.error()` for authentication errors and critical issues
  - [ ] Use `logger.warn()` for non-critical issues and warnings
  - [ ] Use `logger.info()` for general application flow information
  - [ ] Use `logger.debug()` for detailed debugging information (development only)
- [ ] Verify production logging configuration (AC: 3)
  - [ ] Ensure Winston logger is properly configured for production
  - [ ] Verify log files are being written correctly
  - [ ] Test log rotation and file management
  - [ ] Confirm structured logging format is consistent
- [ ] Code quality validation (AC: 5)
  - [ ] Add ESLint rule to prevent console statements in core application code
  - [ ] Create automated check to fail CI/CD if console statements are found
  - [ ] Update code review guidelines to check for proper logging
  - [ ] Document logging standards in coding guidelines

## Dev Notes

### Current Console Statement Issues
[Source: SECURITY_AUDIT_FINDINGS.md#console-statement-cleanup]
- **Remaining Issue**: `backend/src/middleware/auth.js:74` - `console.error('Authentication error:', error)`
- **Status**: Partially resolved - setup scripts legitimately use console.log (acceptable)
- **Impact**: Development artifacts in production code

### Winston Logging Architecture
[Source: architecture.md#enterprise-infrastructure]
- **Current Implementation**: Winston-based structured logging with multiple transports
- **Log Files**: `backend/logs/combined.log`, `error.log`, `access.log`, `warnings.log`, `app.log`
- **Features**: Multiple transports, structured data, log rotation

### File Locations
[Source: architecture.md#logging-strategy]
**Files to Update**:
- `backend/src/middleware/auth.js:74` - Replace console.error with logger.error
- `backend/src/utils/logger.js` - Verify logger configuration
- Any other files with console statements in application logic

### Logging Standards Context
[Source: architecture.md#monitoring-and-observability]
**Winston Configuration**:
```text
backend/logs/
├── combined.log          # All application logs
├── error.log            # Error-level logs only  
├── access.log           # HTTP access logs
├── warnings.log         # Warning-level logs (production)
└── app.log              # Application-specific logs (production)
```

### Acceptable Console Usage
[Source: SECURITY_AUDIT_FINDINGS.md#remaining-issues]
- **Setup Scripts**: Database migrations, seed scripts - console.log acceptable
- **CLI Tools**: Command-line utilities - console output expected
- **Build Scripts**: npm scripts and build processes - console output normal
- **Core Application**: NO console statements allowed

### ESLint Configuration
[Source: architecture.md#development-and-deployment]
- **Current**: ESLint configured for code checking
- **Enhancement**: Add no-console rule for application code
- **Exception**: Allow console in scripts/ and migration files

### Production Logging Requirements
[Source: ProcessPilot-Brownfield-PRD.md#enterprise-infrastructure]
- **Structured Logging**: JSON format for log aggregation
- **Log Levels**: Error, warn, info, debug with environment-based filtering
- **Performance**: Non-blocking logging to prevent application slowdown
- **Monitoring Integration**: Compatible with log aggregation services

### Testing Standards
[Source: architecture.md#testing-infrastructure]
**Testing Requirements**:
- **Unit Tests**: Test that errors are properly logged with Winston
- **Integration Tests**: Verify log output in test scenarios
- **Lint Tests**: Verify no console statements in core application code

### Code Quality Integration
[Source: ProcessPilot-Brownfield-PRD.md#code-quality-improvements]
- **Impact**: Medium - affects code maintainability
- **Effort**: 1 hour of systematic refactoring
- **Business Value**: Improved production logging and monitoring

## Change Log
| Date       | Version | Description                           | Author    |
|------------|---------|---------------------------------------|-----------|
| 2025-08-28 | 1.0     | Initial story creation from security audit | Bob (Scrum Master) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References  
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results
*Results from QA Agent QA review will be populated here*