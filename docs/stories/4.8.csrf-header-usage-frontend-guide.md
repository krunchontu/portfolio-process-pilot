# <!-- Powered by BMADT Core -->

# Story 4.8: CSRF Header Usage in Frontend Guide

## Status
Draft

## Story
**As a** frontend developer,
**I want** clear guidance and an example for sending CSRF tokens in unsafe requests,
**So that** the app remains protected while keeping auth cookie-based and stateless.

## Acceptance Criteria
1. Frontend documentation includes a short section showing how to echo `XSRF-TOKEN` cookie in `X-CSRF-Token` (or `X-XSRF-Token`) header for POST/PUT/PATCH/DELETE.
2. The example aligns with current axios setup (`withCredentials: true`) and does not store tokens in localStorage.
3. Mention that backend injects a fresh CSRF token in responses and sets the `XSRF-TOKEN` cookie on safe requests; note that this cookie is not httpOnly by design to allow echoing in headers. Guidance explains when the header is required and when auth endpoints are exempt.
4. E2E/security docs reference the CSRF section and confirm tests cover the behavior.
5. No code changes are mandated in this story; it is documentation-only and consistent with middleware expectations.

## Tasks / Subtasks
- [ ] Add a CSRF section to `frontend/tests/e2e/README.md` or README (AC: 1–3)
  - [ ] Include a minimal axios interceptor snippet (docs-only) to read `XSRF-TOKEN` from `document.cookie` and set `X-CSRF-Token` for unsafe methods
  - [ ] Note that login/register may be exempt per backend middleware
- [ ] Cross-reference tests (AC: 4)
  - [ ] Link Playwright security spec and unit test that simulate CSRF header usage (e.g., `frontend/tests/e2e/authentication-security.spec.js#csrf-protection-tests`, `frontend/tests/security/regression-prevention.test.js`)
- [ ] Verification (AC: 1–5)
  - [ ] Ensure guidance does not suggest localStorage token storage
  - [ ] Confirm wording matches backend middleware behavior

## Dev Notes

### Relevant Code & Docs
- Axios instance: `frontend/src/services/api.js` (uses `withCredentials: true`)
- CSRF middleware: `backend/src/middleware/csrf.js` (double submit cookie, header required for unsafe methods)
- Tests: `frontend/tests/e2e/authentication-security.spec.js`, `frontend/tests/security/regression-prevention.test.js`

### References
- [Source: backend/src/middleware/csrf.js]
- [Source: frontend/tests/e2e/README.md#security-tests]

## Change Log
| Date       | Version | Description                           | Author            |
|------------|---------|---------------------------------------|-------------------|
| 2025-09-14 | 1.0     | Initial draft of Story 4.8            | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
N/A (Story draft)

### Debug Log References
- Planned: CI logs referencing E2E security runs
