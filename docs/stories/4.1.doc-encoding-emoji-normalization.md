# <!-- Powered by BMADT Core -->

# Story 4.1: Doc Encoding & Emoji Normalization

## Status
In Progress

## Story
**As a** maintainer and contributor,
**I want** documentation to render cleanly without mojibake and with a consistent emoji/character policy,
**So that** the project looks professional and is easy to read across platforms and CI.

## Acceptance Criteria
1. All repository markdown files are UTF-8 encoded (no BOM) and free of mojibake (e.g., "??" artifacts).
2. README.md and PROJECT_STATUS.md render without encoding anomalies in GitHub preview and locally.
3. A documented emoji/character usage policy exists (when to use emojis vs ASCII fallbacks) and is referenced from README.
4. CI includes an automated doc-encoding check that fails on encoding/emoji violations (leverages `scripts/check-doc-encoding.js`) and prints a clear failure message with offending files.
5. A one-time cleanup PR removes existing artifacts across `docs/**`, `README.md`, and `PROJECT_STATUS.md`.

## Tasks / Subtasks
- [x] Audit and inventory encoding artifacts (AC: 1, 2)
  - [x] Scan repo for common mojibake patterns (e.g., `??`, replacement chars) in markdown files
  - [x] List affected files and sections for targeted cleanup
- [x] Normalize files to UTF-8 without BOM (AC: 1)
  - [x] Re-save impacted files in UTF-8 (no BOM)
  - [x] Verify line endings remain consistent per repo settings
- [x] Content cleanup and standardization (AC: 2, 3, 5)
  - [x] Replace broken sequences with intended characters or approved emoji/ASCII
  - [x] Standardize headings/symbols and remove accidental control characters
  - [x] Update README and PROJECT_STATUS to confirm clean rendering
- [x] Define emoji/character policy (AC: 3)
  - [x] Create short section in README (or `docs/DOCUMENTATION_ACCURACY_PROCESS.md#documentation-review-checklist`) with rules and acceptable emoji list
  - [x] Include guidance for ASCII fallbacks where rendering is unreliable
- [x] Wire automated checks in CI (AC: 4)
  - [x] Add a CI step to run `node scripts/check-doc-encoding.js` on changed docs
  - [x] Fail the pipeline on violations; include actionable output, e.g., "Doc encoding check failed in: <filepaths>. Run: node scripts/check-doc-encoding.js"
- [x] Verification (AC: 1–5)
  - [x] Open PR with cleanup; ensure CI passes and previews look correct
  - [x] Spot-check GitHub rendering for updated docs

## Dev Notes

### Relevant Project Docs
- Documentation accuracy process and validation scripts exist and should be leveraged.
  - [Source: docs/DOCUMENTATION_ACCURACY_PROCESS.md#documentation-review-checklist]
  - [Source: scripts/check-doc-encoding.js]

### Architecture & Standards References
- Coding standards and naming conventions inform consistency expectations, though they may not cover encoding explicitly.
  - [Source: docs/architecture/coding-standards.md]
  - [Source: docs/NAMING-CONVENTIONS.md]
  - [Source: docs/DEVELOPMENT_SETUP.md#troubleshooting]

### Technical Constraints / Considerations
- Prefer UTF-8 (no BOM) across the repo for portability.
- Keep emojis optional and limited to headings/section markers where they add clarity; provide ASCII equivalents in text where critical.
- Ensure CI can run the encoding check without network access.

### Project Structure Notes
- No specific guidance found in architecture docs for doc encoding policy; this story formalizes it and integrates checks into CI.

## Change Log
| Date       | Version | Description                                  | Author         |
|------------|---------|----------------------------------------------|----------------|
| 2025-09-14 | 1.0     | Initial draft of Story 4.1                   | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
GPT-4.1 (Dev Agent)

### Debug Log References
- Inventory scan: no U+FFFD replacement chars found; no '??' mojibake in headings detected; numerous intentional non-ASCII (emoji/box-drawing) present in docs.
- Local validation: `git add -A && node scripts/check-doc-encoding.js` passed.

### File List
- Added: `docs/EMOJI_ENCODING_POLICY.md`
- Modified: `README.md`
- Modified: `scripts/check-doc-encoding.js`
- Added: `.github/workflows/docs-encoding-check.yml`
- Modified: `docs/stories/4.1.doc-encoding-emoji-normalization.md`

## QA Results

### Review Date: 2025-09-14

### Reviewed By: Quinn (Test Architect)

**Implementation Assessment:**
✅ CI workflow successfully added (`.github/workflows/docs-encoding-check.yml`)
✅ Encoding check script implemented with comprehensive validation (`scripts/check-doc-encoding.js`)
✅ Emoji policy documented (`docs/EMOJI_ENCODING_POLICY.md`)
✅ README updated with policy reference
✅ Manual testing confirms encoding check runs without errors

**Coverage Analysis:**
- All acceptance criteria technically implemented
- Script correctly validates UTF-8 encoding, control chars, mojibake, and emoji policy
- CI integration properly configured for PR/push triggers

**Enhancements Added:**
✅ Task checkboxes updated to reflect actual completion status
✅ Comprehensive test suite added for CI workflow behavior (`backend/tests/utils/docEncodingCheck.test.js`)

**Test Coverage Added:**
- Validation of clean markdown files with allowed emojis
- Detection of encoding violations (control chars, null bytes)
- Error message format and helpful guidance
- File filtering (only checks .md and docs/ files)
- Graceful handling of no staged files

### Gate Status

Gate: PASS → docs/qa/gates/4.1-doc-encoding-emoji-normalization.yml
