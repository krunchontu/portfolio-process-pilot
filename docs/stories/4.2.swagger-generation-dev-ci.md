# <!-- Powered by BMADT Core -->

# Story 4.2: Wire Swagger Generation into Dev & CI

## Status
Draft

## Story
**As a** developer and CI user,
**I want** Swagger JSON to be generated automatically in dev and validated in CI,
**So that** API docs are always up to date and frontend type generation remains reliable.

## Acceptance Criteria
1. A repeatable command generates `backend/docs/swagger.json` from source annotations/scripts.
2. Local dev flow documents how to regenerate Swagger and serve docs without 404s.
3. CI pipeline updates under `.github/workflows/backend-ci.yml` run Swagger dump and fail when committed `swagger.json` is stale (diff check).
4. Frontend `npm run api:types` succeeds locally and in CI using the generated `swagger.json`.
5. README (or DEV_SETUP) includes a brief “API Docs & Types” section with commands.

## Tasks / Subtasks
- [ ] Backend scripts (AC: 1)
  - [ ] Verify/update `npm run swagger:json` to output `backend/docs/swagger.json`
  - [ ] Ensure script works cross-platform and without network access
- [ ] Dev experience (AC: 2, 5)
  - [ ] Add docs: how to regenerate (`npm run swagger:json`) and preview (`/docs`, `/api/swagger.json`)
  - [ ] Note common pitfalls and location of output file
- [ ] CI integration (AC: 3)
  - [ ] Update `.github/workflows/backend-ci.yml` to run swagger dump early in the job
  - [ ] Add a diff check step, e.g.: `git diff --exit-code backend/docs/swagger.json || (echo "Swagger is stale. Run: npm --prefix backend run swagger:json" && exit 1)`
  - [ ] Provide actionable failure message to run the local command and re-commit
- [ ] Frontend types (AC: 4)
  - [ ] Confirm `frontend npm run api:types` consumes `../backend/docs/swagger.json`
  - [ ] Add CI step to run `api:types` to validate generation
- [ ] Verification (AC: 1–5)
  - [ ] Open PR with updated `swagger.json` and CI workflow
  - [ ] Ensure FE type generation works locally and in CI

## Dev Notes

### Relevant Project Docs & Scripts
- Swagger dump script exists in backend: `scripts: { "swagger:json": "node src/scripts/dump-swagger.js" }`
- Frontend type generation references `../backend/docs/swagger.json` via `api:types`
- Additions required in CI workflows under `.github/workflows/`

### Architecture & Standards References
- [Source: docs/architecture/coding-standards.md]
- [Source: docs/DEVELOPMENT_SETUP.md]

### Technical Considerations
- Keep generated file in repo to simplify FE type generation; enforce freshness in CI.
- Ensure the Swagger source is the single source of truth (annotations/config).

## Change Log
| Date       | Version | Description                           | Author            |
|------------|---------|---------------------------------------|-------------------|
| 2025-09-14 | 1.0     | Initial draft of Story 4.2            | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
N/A (Story draft)

### Debug Log References
- Planned: CI job logs for swagger diff check and FE type gen
